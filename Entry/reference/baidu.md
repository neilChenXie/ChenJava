# Baidu Exp

based on [Baidu](http://zhuanlan.zhihu.com/p/20390103?refer=sangwf)

## Core

1. baidu Nslog 部门

    ```
    统计的方式是这样的，各个产品线的业务人员按照需求文档的格式要求，填写统计需求，提交到需求管理平台上，Nslog的团队负责人（开始不是我负责）每周末，将需求分别分配给团队的
    几个成员。每个成员拿到需求列表之后，就挨着做。需求的实现，一般都是写perl脚本，那个时候python还没流行起来。因为统计需求比较类似，一般都是拿一个已有的脚本复制一份，修
    改一下，测试逻辑，测试大数据量下的准确性，然后部署到线上去。一共有20台机器跑统计脚本，每台机器上都用crontab配置天级的例行任务。每个统计脚本的逻辑大概是这样的：通过
    wget从数据源服务器上抓取按小时切割的日志文件，完成后，跑统计逻辑，将生成的结果组织成html表格，邮件发送给相应的团队
    ```

2. 统计业务特性, 借鉴awk设计

    ```
    我发现常见的统计有这么三类：
    （1）计数统计：那个时代是流量时代，许多统计就是算PV（Page View）。
        一般是在Apache Web Server日志中，去用正则表达式匹配满足某些条件的记录，做计数。
    （2）去重统计：比如独立IP数，独立用户数等。
    （3）Top N统计：比如昨天检索量最大的100个Query是什么。
    ```

3. Hadoop 加入
4. 前一个架构的日志中转成瓶颈，Mapper直接抓日志(日志太多);MapReduce包装->引入DQuery(类Hive)，变通用计算平台，**统计全在Log平台**。Hive的问题
5. 机器数膨胀，计算为中心->数据为中心

    ```
    前面提到机器数的膨胀太厉害，我们分析这其中的原因，最大的就是中间数据没有得以利用。
    所有的任务都是基于原始日志的，如果生成的中间结果能被重复使用，那就会降低计算量。
    我们就想给中间数据加上Schema，让其他人能够知道平台上已有的数据每一行都表示什么。
    但因为大家已经习惯于从原始数据取，根本就推不动。
    我自己对Schema的价值也理解不到位，思维还是停留在如何做一个更牛逼的计算平台上。

    这种理念的极致是我有一天意识到查询也是一种计算，数据库无非是计算的一种特定模式。
    Log平台是做MapReduce任务的，而LogData是用于Key-Value查询的，甚至是简单的SQL查询，两者能否统一起来？
    在海量数据的情况下，我们是否可以把传统数据库当作Hadoop的缓存来使用，
    如果数据在传统数据库中，我就通过SQL来查询，如果是在Hadoop中，我就转化成MapReduce
    任务，当然响应会更慢一些。对外暴露的接口，统一到我们发明的DQuery。
    ```

    ```
    QA:
    数据仓库就是以数据为中心的思考模式，与之差异的是以计算为中心的思路，
    就是考虑怎么计算的快，吞吐量大，而不思考理解数据。
    相比传统数据仓库，新的以数据为中心的思路依赖的底层技术是云计算技术。
    ```

6. 2011年成立Data部门，主攻UDW（User Data Warehouse），用户行为数据（UserID，Event Type，事件相关的其他属性），Log->Structured Data->UDW
7. Google Protocol Buffer. Log -> PB -> UDW, 数据源的PB化

    ```
    自底向上，我们可以把数据源从产生到最终可视化，看做一条流。这种数据流的意识，是
    在我做了3~4年的数据工作之后才主要认识清晰的。从源头来说，我们通过日志打印库完
    成数据的生成工作。然后通过一个叫Minos的系统完成数据的实时传输，这个系统类似
    Scribe和Flume，在运维性上，要好非常多。如果需要入UDW，就通过ETL框架实现，否则
    就直接存放为PB格式。通过Query Engine提供查询服务，这基于Hive修改，后来我们开
    发了一套叫Wing的查询引擎，比Hive性能提升很多。通过Insight来实现数据的报表、曲
    线之类的可视化。此外，还需要有Meta Server管理元数据，通过Scheduler完成任务调
    度，这些都是我们自己开发的。
    ```

8. 第三方，SQL，Log Process优劣分析。业务数据库和数据仓库的差别

    ```
    首先，我们要弄清楚业务数据库和数据仓库这两个概念。对于数据规模较小的情况下，
    业务数据库和数据仓库都能通过MySQL/Oracle这样的软件来管理，那么两者是不是等
    价的？是不是业务数据库就能当成数据仓库来使用？这里我们要看看两者分别是干嘛的
    。业务数据库是要处理高并发、小批量的请求，一般是对单条数据的增删改查。而数据
    仓库是用于数据分析的，它是处理小并发、大批量的请求，比如最近一年满足某些筛选
    条件的数据，但是查询的频次不高。那么在数据存储上，两者就有了本质区别，我们可
    以用人类进化的一张图来表示。
    ```

9. 大数据的定义，**数据处理** 五个阶段

    ```
    数据采集、数据传输、数据建模/存储、数据统计/分析/挖掘、数据可视化/反馈
    ```

10. 源的特点，经验

11. Source to Data platform

12. 多维数据模型

13. 统计，分析，挖掘

14. 可视化

15. 调度器

16. 元数据
